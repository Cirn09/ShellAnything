<?xml version="1.0" encoding="utf-8"?>
<!--
Help:
  ${selection.path} is the full path of the clicked element
  ${selection.parent.path} is the full path of the parent element
  ${selection.parent.filename} is the filename of the parent element
  ${selection.filename} is selection.filename (including file extension)
  ${selection.filename_noext} is selection.filename without file extension
  
  ${env.XYZ} refers to environment variable XYZ
  
  Property names must not contain spaces
  Property lists must be separated by ';' character
  File extension lists must be separated by ';' character
  
-->
<root>
  <shell>
    <menu name="Copy to clipboard...">
      <icon path="C:\Windows\System32\shell32.dll" index="68" />
      <!--TODO: update the visibility tag to support a maxfiles="1" attribute or maxfolders="1" instead of -->
      <validity folder="true" file="true" maxfiles="1" maxfolders="1" />
      <menu name="Full Path" description="Copy the selected file path(s) to the clipboard">
        <icon path="C:\Windows\System32\shell32.dll" index="165" />
        <actions>
          <!--TODO: update clipboard tag to support multiple selection-->
          <clipboard value="${selection.path}"/>
        </actions>
      </menu>
      <menu name="Filename" description="Copy the selected filename(s) to the clipboard">
        <icon path="C:\Windows\System32\shell32.dll" index="2" />
        <actions>
          <clipboard value="${selection.filename}"/>
        </actions>
      </menu>
      <menu name="Filename (without extension)" description="Copy the selected filename(s) (without extension) to the clipboard">
        <icon path="C:\Windows\System32\shell32.dll" index="0" />
        <actions>
          <clipboard value="${selection.filename_noext}"/>
        </actions>
      </menu>
      <menu name="Parent Folder">
        <icon path="C:\Windows\System32\shell32.dll" index="3" />
        <actions>
          <clipboard value="${selection.parent.path}"/>
        </actions>
      </menu>
    </menu>
    
    <menu name="Command line from here...">
      <icon path="C:\Windows\System32\cmd.exe" index="0" />
      <validity folder="true" />
      <actions>
        <exec path="C:\windows\system32\cmd.exe" basedir="${selection.path}" />
      </actions>
    </menu>
    
    <menu name="Run with parameters..." description="Run the selected executable with parameters">
      <icon path="C:\Windows\System32\shell32.dll" index="76" />
      <validity fileextensions="com;exe;bat;cmd" />
      <actions>
        <prompt name="myarguments" title="Please enter the command line parameters" />
        <exec path="${selection.path}" arguments="${myarguments}" />
      </actions>
    </menu>

    <menu separator="true" />

    <menu name="Foo Service">
      <!--Note: validity is not specified, the menu is always valid-->
      <icon path="C:\Windows\System32\cmmon32.exe" index="0" />
      
      <menu name="Stop" icon="C:\Program Files (x86)\FooSoftwares\stop.exe">
        <!--<icon path="C:\Windows\System32\shell32.dll" index="109" />-->
        <icon path="C:\Windows\System32\imageres.dll" index="100" />
        <actions>
          <exec path="C:\Program Files (x86)\FooSoftwares\stop.exe" />
        </actions>
      </menu>
      <menu name="Start" icon="C:\Program Files (x86)\FooSoftwares\start.exe">
        <!--<icon path="C:\Windows\System32\shell32.dll" index="137" />-->
        <icon path="C:\Windows\System32\imageres.dll" index="101" />
        <actions>
          <exec path="C:\Program Files (x86)\FooSoftwares\start.exe" />
        </actions>
      </menu>
      <menu name="Restart">
        <!--<icon path="C:\Windows\System32\shell32.dll" index="238" />-->
        <icon path="C:\Windows\System32\wmploc.dll" index="151" />
        <actions>
          <exec path="C:\Program Files (x86)\FooSoftwares\stop.exe" />
          <exec path="C:\Program Files (x86)\FooSoftwares\start.exe" />
        </actions>
      </menu>
      
      <!--Split commands that are for the same purpose-->
      <menu separator="true" />
      
      <menu name="Connect">
        <icon path="C:\Windows\System32\shell32.dll" index="44" />
        <actions>
          <exec path="C:\Program Files (x86)\FooSoftwares\foo.exe" arguments="/connect" />
        </actions>
      </menu>
      <menu name="Update">
        <!--<icon path="C:\Windows\System32\imageres.dll" index="194" />-->
        <icon path="C:\Windows\System32\shell32.dll" index="46" />
        <actions>
          <exec path="C:\Program Files (x86)\FooSoftwares\foo.exe" arguments="/update" />
        </actions>
      </menu>
    </menu>

    <!--Split before winzip commands-->
    <menu separator="true" />
    <menu name="Winzip">
      <icon path="C:\Windows\System32\zipfldr.dll" index="0" />
      <menu name="Add ${selection.filename}.zip" icon="auto">
        <!-- Note that icon attribute is set to auto for this menu which should use the first icon of the menu's first shell command -->
        <validity folder="true" />
        <actions>
          <exec path="C:\Program Files (x86)\WinZip\winzip32.exe" arguments="-a -r &quot;${selection.path}\${selection.filename}.zip&quot; &quot;${selection.path}&quot;" />
        </actions>
      </menu>
      <menu name="Extract to folder ${selection.filename}" icon="auto">
        <!-- Note that icon attribute is set to auto for this menu which should use the first icon of the menu's first shell command -->
        <validity fileextensions="zip" />
        <actions>
          <exec path="C:\Program Files (x86)\WinZip\winzip32.exe" arguments="-e &quot;${selection.path}&quot; &quot;${selection.parent.path}\${selection.filename_noext}&quot;" />
        </actions>
      </menu>
      <menu name="Extract here" icon="auto">
        <!-- Note that icon attribute is set to auto for this menu which should use the first icon of the menu's first shell command -->
        <validity fileextensions="zip" />
        <actions>
          <exec path="C:\Program Files (x86)\WinZip\winzip32.exe" arguments="-e &quot;${selection.path}&quot; &quot;${selection.parent.path}&quot;" />
        </actions>
      </menu>
    </menu>


    <!--Show file selection or compare capabilities-->
    <menu separator="true" />
    <menu name="Compare">
      <icon path="C:\Windows\System32\dsuiext.dll" index="32" />
      <menu name="Binary compare">
        <icon path="C:\Windows\System32\compstui.dll" index="39" />
        <menu name="Select file '${selection.filename}'">
          <actions>
            <property name="compare.first.selection.path"     value="${selection.path}" />
            <property name="compare.first.selection.filename" value="${selection.filename}" />
          </actions>
        </menu>
        <menu name="Compare with '${compare.first.selection.filename}'">
          <!--Note: this menu is always enabled but can be invisible if the visibility tag is not respected-->
          <visibility properties="compare.first.selection.filename" />
          <actions>
            <exec path="C:\windows\system32\cmd.exe" arguments="/K FC /B &quot;${compare.first.selection.path}&quot; &quot;${selection.path}&quot;" />

            <!--Reset the properties now that compare is complete-->
            <property name="compare.first.selection.path"     value="" />
            <property name="compare.first.selection.filename" value="" />
          </actions>
        </menu>
      </menu>
    </menu>

    <!--Low level find file-->
    <menu separator="true" />
    <menu name="Find file...">
      <icon path="C:\Windows\System32\shell32.dll" index="22" />
      <validity folder="true" maxfiles="0" maxfolders="1" />
      <actions>
        <prompt name="findpattern" title="Please enter the find wildcard pattern..." />
        <exec path="C:\windows\system32\cmd.exe" basedir="${selection.path}" arguments="/K dir /a /s /b &quot;${findpattern}&quot;" />
        <property name="findpattern" value="" />
      </actions>
    </menu>
    <menu name="Find in files...">
      <icon path="C:\Windows\System32\shell32.dll" index="55" />
      <validity folder="true" maxfiles="0" maxfolders="1" />
      <actions>
        <prompt name="filepattern" title="Please enter the file wildcard pattern..." />
        <prompt name="textpattern" title="Please enter the searched text..." />
        <exec path="C:\windows\system32\cmd.exe" basedir="${selection.path}" arguments="/K FINDSTR /S &quot;/C:${textpattern}&quot; ${filepattern}" />
        <property name="filepattern" value="" />
        <property name="textpattern" value="" />
      </actions>
    </menu>

    <!-- Open files that are not executables -->
    <menu separator="true" />
    <menu name="MySoftware">
      <icon path="C:\windows\system32\dccw.exe" index="0" />
      <menu name="README">
        <!--<icon path="C:\Program Files\Windows NT\Accessories\wordpad.exe" index="0" />-->
        <icon path="C:\windows\system32\write.exe" index="0" />
        <actions>
          <open path="C:\Program Files (x86)\MySoftware\README.pdf" />
        </actions>
      </menu>
      <menu name="About">
        <icon path="C:\Windows\System32\imageres.dll" index="102" />
        <actions>
          <open path="C:\Program Files (x86)\MySoftware\about.htm" />
        </actions>
      </menu>
    </menu>
    
    <!-- Open files that are not executables -->
    <menu separator="true" />
    <menu name="Checksum">
      <icon path="C:\Windows\System32\shell32.dll" index="104" />
      <validity file="true" maxfiles="1" maxfolders="0" />
      <menu name="MD5">
        <actions>
          <exec path="C:\windows\system32\cmd.exe" arguments="/K CertUtil -hashfile &quot;${selection.path}&quot; MD5" />
        </actions>
      </menu>
      <menu name="SHA1">
        <actions>
          <exec path="C:\windows\system32\cmd.exe" arguments="/K CertUtil -hashfile &quot;${selection.path}&quot; SHA1" />
        </actions>
      </menu>
      <menu name="SHA256">
        <actions>
          <exec path="C:\windows\system32\cmd.exe" arguments="/K CertUtil -hashfile &quot;${selection.path}&quot; SHA256" />
        </actions>
      </menu>
      <menu name="SHA512">
        <actions>
          <exec path="C:\windows\system32\cmd.exe" arguments="/K CertUtil -hashfile &quot;${selection.path}&quot; SHA512" />
        </actions>
      </menu>
    </menu>

    <!-- symbolic links -->
    <menu separator="true" />
    <menu name="Symbolic Links ">
      <icon path="C:\Windows\System32\imageres.dll" index="154" />
      <!-- See also https://stackoverflow.com/questions/19098101/how-to-open-an-elevated-cmd-using-command-line-for-windows -->
      <validity file="false" maxfiles="0" maxfolders="1" />
      <menu name="Set as target">
        <actions>
          <property name="symbolic.target.path"     value="${selection.path}" />
          <property name="symbolic.target.filename" value="${selection.filename}" />
        </actions>
      </menu>
      <menu name="Cancel link creation." description="">
        <visibility properties="symbolic.target.path" />
        <actions>
          <property name="symbolic.target.path"     value="" />
          <property name="symbolic.target.filename" value="" />
        </actions>
      </menu>
      <menu name="Create link to ${symbolic.target.filename} as..." description="Creates a symbolic link.">
        <visibility properties="symbolic.target.path" />
        <menu name="Symbolic Link" description="Creates a directory symbolic link.">
          <visibility properties="symbolic.target.path" />
          <actions>
            <exec path="C:\windows\system32\cmd.exe" arguments="/K mklink /D &quot;${selection.parent.path}\${symbolic.target.filename}&quot; &quot;${symbolic.target.path}&quot;" />
          </actions>
        </menu>
        <menu name="Hard Link" description="Creates a directory hard link.">
          <visibility properties="symbolic.target.path" />
          <actions>
            <exec path="C:\windows\system32\cmd.exe" arguments="/K mklink /H &quot;${selection.parent.path}\${symbolic.target.filename}&quot; &quot;${symbolic.target.path}&quot;" />
          </actions>
        </menu>
        <menu name="Junction" description="Creates a directory junction.">
          <visibility properties="symbolic.target.path" />
          <actions>
            <exec path="C:\windows\system32\cmd.exe" arguments="/K mklink /J &quot;${selection.parent.path}\${symbolic.target.filename}&quot; &quot;${symbolic.target.path}&quot;" />
          </actions>
        </menu>
      </menu>

    </menu>

  </shell>
</root>